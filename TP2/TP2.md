# TP2 : Environnement virtuel

## I. Topologie réseau
☀️ Sur node1.lan1.tp2

- afficher ses cartes réseau
```
[hugo@node1lan1tp2 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:b6:0f:a4 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:feb6:fa4/64 scope link
       valid_lft forever preferred_lft forever
```

- afficher sa table de routage

```
[hugo@node1lan1tp2 ~]$ ip route show
10.1.1.0/24 dev enp0s3 proto kernel scope link src 10.1.1.11 metric 100
10.1.2.0/24 via 10.1.1.254 dev enp0s3 proto static metric 100
``` 
- prouvez qu'il peut joindre node2.lan2.tp2

```
[hugo@node1lan1tp2 ~]$ ping 10.1.2.12
PING 10.1.2.12 (10.1.2.12) 56(84) bytes of data.
64 bytes from 10.1.2.12: icmp_seq=1 ttl=63 time=1.67 ms
64 bytes from 10.1.2.12: icmp_seq=2 ttl=63 time=1.74 ms
64 bytes from 10.1.2.12: icmp_seq=3 ttl=63 time=1.52 ms
64 bytes from 10.1.2.12: icmp_seq=4 ttl=63 time=1.83 ms
^C
--- 10.1.2.12 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3007ms
rtt min/avg/max/mdev = 1.515/1.690/1.833/0.116 ms
```
- prouvez avec un traceroute que le paquet passe bien par router.tp2

```
[hugo@node1lan1tp2 ~]$ traceroute 10.1.2.12
traceroute to 10.1.2.12 (10.1.2.12), 30 hops max, 60 byte packets
 1  10.1.1.254 (10.1.1.254)  4.409 ms  4.192 ms  3.974 ms
 2  10.1.2.12 (10.1.2.12)  3.262 ms !X  3.006 ms !X  2.804 ms !X
```

## II. Interlude accès internet

☀️ Sur router.tp2
- prouvez que vous avez un accès internet (ping d'une IP publique)

```
[hugo@router ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=113 time=21.6 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=113 time=21.5 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=113 time=19.7 ms
^C
--- 8.8.8.8 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2005ms
rtt min/avg/max/mdev = 19.717/20.919/21.557/0.850 ms
```

- prouvez que vous pouvez résoudre des noms publics (ping d'un nom de domaine public)

```
[hugo@router ~]$ ping youtube.com
PING youtube.com (142.250.179.110) 56(84) bytes of data.
64 bytes from par21s20-in-f14.1e100.net (142.250.179.110): icmp_seq=1 ttl=116 time=19.5 ms
64 bytes from par21s20-in-f14.1e100.net (142.250.179.110): icmp_seq=2 ttl=116 time=20.0 ms
64 bytes from par21s20-in-f14.1e100.net (142.250.179.110): icmp_seq=3 ttl=116 time=19.6 ms
^C
--- youtube.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2008ms
rtt min/avg/max/mdev = 19.503/19.699/20.026/0.232 ms
```

☀️ Accès internet LAN1 et LAN2

- dans le compte-rendu, mettez-moi que la conf des points précédents sur node2.lan1.tp2


```
[hugo@node1lan1tp2 ~]$ ip route show
default via 10.1.1.254 dev enp0s3 proto static metric 100
10.1.1.0/24 dev enp0s3 proto kernel scope link src 10.1.1.11 metric 100
10.1.2.0/24 via 10.1.1.254 dev enp0s3 proto static metric 100
```
```bash
[hugo@node1lan1tp2 ~]$ sudo cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 8.8.8.8
nameserver 1.1.1.1
```
- prouvez que node2.lan1.tp2 a un accès internet :

    - il peut ping une IP publique
    - il peut ping un nom de domaine public


```
[hugo@node1lan1tp2 ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=21.2 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=112 time=21.1 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=112 time=20.2 ms
^C
--- 8.8.8.8 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2005ms
rtt min/avg/max/mdev = 20.171/20.830/21.170/0.466 ms
```

```
[hugo@node1lan1tp2 ~]$ ping youtube.com
PING youtube.com (142.250.179.110) 56(84) bytes of data.
64 bytes from par21s20-in-f14.1e100.net (142.250.179.110): icmp_seq=1 ttl=115 time=20.6 ms
64 bytes from par21s20-in-f14.1e100.net (142.250.179.110): icmp_seq=2 ttl=115 time=20.4 ms
64 bytes from par21s20-in-f14.1e100.net (142.250.179.110): icmp_seq=3 ttl=115 time=20.5 ms
^C
--- youtube.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2004ms
rtt min/avg/max/mdev = 20.398/20.479/20.585/0.078 ms
```

## III. Services réseau
- prouvez qu'il y a un programme NGINX qui tourne derrière le port 80 de la machine (commande ss)
```
[hugo@weblan2tp2 ~]$ ss -atnl
State   Recv-Q  Send-Q   Local Address:Port     Peer Address:Port  Process
LISTEN  0       511            0.0.0.0:80            0.0.0.0:*
LISTEN  0       128            0.0.0.0:22            0.0.0.0:*
LISTEN  0       511               [::]:80               [::]:*
LISTEN  0       128               [::]:22               [::]:*
```
- prouvez que le firewall est bien configuré

``` 
[hugo@weblan2tp2 ~]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s3
  sources:
  services: cockpit dhcpv6-client ssh
  ports: 80/tcp
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
  ```


☀️ Sur node1.lan1.tp2
- éditez le fichier hosts pour que site_nul.tp2 pointe vers l'IP de web.lan2.tp2
```
[hugo@node1lan1tp2 ~]$ sudo cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
10.1.2.12 site_nul.tp2
```
- visitez le site nul avec une commande curl et en utilisant le nom site_nul.tp2

```bash
[hugo@node1lan1tp2 ~]$ curl site_nul.tp2
<h1>laoala</h1>
[hugo@node1lan1tp2 ~]$
```

## 2. Or is it ? Bonus : DHCP
